{
  "$schema": "../tool-config.schema.json",

  "id": "claude",
  "name": "Claude Desktop",
  "vendor": "Anthropic",
  "vendor_url": "https://anthropic.com",
  "category": "ai-chat",

  "source_type": "app",

  "api_domains": [
    "claude.ai",
    "api.anthropic.com",
    "a-api.anthropic.com"
  ],

  "signatures": {
    "macos": {
      "bundle_id": "com.anthropic.claudefordesktop",
      "team_id": "Q6L2SF6YDW"
    },
    "windows": {
      "exe_name": "Claude.exe",
      "publisher": "Anthropic"
    }
  },

  "icon": "claude.png",

  "meta": {
    "docs_url": "https://docs.anthropic.com"
  },

  "features": {
    "chat": {
      "type": "chat",
      "name": "Chat Conversation",
      "description": "Real-time SSE streaming of Claude responses with extended thinking",

      "endpoints": [
        {
          "role": "both",
          "match": {
            "url": "**/api/organizations/*/chat_conversations/*/completion",
            "method": "POST"
          },
          "pipeline": [
            { "op": "parse", "format": "json", "apply_to": "request" },
            {
              "op": "stream",
              "transport": "sse",
              "apply_to": "response",
              "options": {
                "prefixes": ["data: "],
                "skip": ["[DONE]"]
              }
            },
            {
              "op": "accumulate",
              "apply_to": "response",
              "rules": [
                { "when": "type = 'message_start'", "set": { "model": "message.model", "message_id": "message.uuid" } },
                { "when": "type = 'content_block_start' and content_block.type = 'thinking'", "set": { "has_thinking": "true" } },
                { "when": "type = 'content_block_delta' and delta.type = 'text_delta'", "set": { "content": "delta.text" } },
                { "when": "type = 'content_block_delta' and delta.type = 'thinking_delta'", "set": { "thinking": "delta.thinking" } },
                { "when": "type = 'content_block_delta' and delta.type = 'thinking_summary_delta'", "set": { "thinking_summary": "delta.summary.summary" } },
                { "when": "type = 'message_stop'", "set": { "completed": "true" } }
              ],
              "fields": {
                "content": { "from": "content", "method": "concat" },
                "thinking": { "from": "thinking", "method": "concat" },
                "thinking_summary": { "from": "thinking_summary", "method": "last" },
                "model": { "from": "model", "method": "first" },
                "message_id": { "from": "message_id", "method": "first" },
                "has_thinking": { "from": "has_thinking", "method": "first" }
              }
            }
          ],
          "extract": {
            "request.prompt": "prompt",
            "request.parent_message": "parent_message_uuid",
            "request.file_uuids": "files",
            "request.has_files": "$count(files) > 0",
            "response.content": "$accumulated.content",
            "response.thinking": "$accumulated.thinking",
            "response.thinking_summary": "$accumulated.thinking_summary",
            "response.model": "$accumulated.model",
            "response.message_id": "$accumulated.message_id",
            "response.has_thinking": "$accumulated.has_thinking"
          }
        }
      ],

      "output": {
        "mode": "extract",
        "tag": "ai:chat",
        "normalize": {
          "interaction.type": "'chat'",
          "interaction.input.text": "$request.prompt",
          "interaction.input.file_uuids": "$request.file_uuids",
          "interaction.input.has_files": "$request.has_files",
          "interaction.output.text": "$response.content",
          "interaction.output.thinking": "$response.thinking",
          "interaction.output.thinking_summary": "$response.thinking_summary",
          "interaction.model": "$response.model",
          "interaction.message_id": "$response.message_id",
          "interaction.has_extended_thinking": "$response.has_thinking"
        },
        "include_raw": false
      }
    }
  },

  "detection": [
    {
      "id": "subscription_details",
      "match": { "url": "**/api/organizations/*/subscription_details" },
      "extract": {
        "subscription.status": "status",
        "subscription.billing_interval": "billing_interval",
        "subscription.next_charge_date": "next_charge_date",
        "subscription.payment_method.brand": "payment_method.brand",
        "subscription.payment_method.last4": "payment_method.last4"
      }
    },
    {
      "id": "organization_info",
      "match": { "url": "**/api/organizations/*" },
      "when": "$exists(uuid) and $exists(name)",
      "extract": {
        "org.id": "uuid",
        "org.name": "name",
        "org.capabilities": "capabilities",
        "org.rate_limit_tier": "rate_limit_tier",
        "org.billing_type": "billing_type"
      }
    }
  ],

  "pricing": {
    "model": ["subscription"],
    "tiers": [
      { "id": "free", "name": "Free", "type": "free", "monthly_usd": 0 },
      { "id": "pro", "name": "Pro", "type": "individual", "monthly_usd": 20 },
      { "id": "team", "name": "Team", "type": "team", "monthly_usd": 25 },
      { "id": "enterprise", "name": "Enterprise", "type": "enterprise", "monthly_usd": null }
    ]
  }
}
